---
name: 1c-feature-dev
description: "Полный цикл разработки доработок 1С — от анализа до реализации с БСП compliance. 9 фаз: оценка, discovery, исследование, уточнение, проектирование, ревью плана, реализация, ревью кода, итоги."
argument-hint: <описание доработки>
allowed-tools:
  - Bash
  - Read
  - Write
  - Edit
  - Glob
  - Grep
  - Task
  - AskUserQuestion
---

# /1c-feature-dev — Полный цикл разработки 1С

Полный цикл разработки доработок 1С с использованием спецификаций, адаптивного подхода и интеграции с инструментами (RLM, BSL LSP, MCP).

## ПРИНЦИПЫ РАБОТЫ

- **Адаптивность**: Количество агентов зависит от сложности (1-4+)
- **Ранняя валидация**: Ревью плана ДО реализации
- **Уточнение требований**: Все неоднозначности разрешаются ДО проектирования
- **Атомарные этапы**: С критериями приемки и проверками
- **Отслеживание прогресса**: Каждая фаза отмечается как завершённая

## WORKFLOW (9 ФАЗ)

### Phase 0: Оценка сложности

**Цель**: Понять масштаб задачи и выбрать стратегию

**Начальный запрос**: $ARGUMENTS

**Действия**:
1. Создать список задач со всеми фазами
2. Создать структуру: `openspec/changes/[feature-name]/`
3. Оценить сложность:
   - **Простая**: Небольшое изменение, очевидная реализация
   - **Средняя**: Несколько модулей, требует понимания архитектуры
   - **Сложная**: Большая доработка, несколько подсистем
   - **Критичная**: Архитектурные изменения, высокие риски
4. Выбрать стратегию (количество агентов)
5. Сохранить: `openspec/changes/[feature-name]/phase0-complexity.md`

### Phase 1: Discovery

**Цель**: Понять, что нужно построить

**Действия**:
1. Если доработка неясна — задать вопросы (AskUserQuestion)
2. Резюмировать понимание
3. Получить подтверждение пользователя
4. Сохранить: `openspec/changes/[feature-name]/phase1-requirements.md`

### Phase 2: Исследование кодовой базы

**Цель**: Понять существующий код и паттерны

**Адаптивный подход**:
- **Простая**: Grep/Glob прямой поиск
- **Средняя**: Task(subagent_type="Explore") для глубокого анализа
- **Сложная**: Несколько параллельных Task(subagent_type="Explore")

**Действия**:
1. Использовать MCP codemetadata/metadatasearch для поиска по кодовой базе
2. Использовать Grep/Glob для поиска паттернов
3. Для сложных задач — запустить Task agents параллельно
4. Сохранить: `openspec/changes/[feature-name]/phase2-exploration.md`

### Phase 3: Уточняющие вопросы

**Цель**: Заполнить пробелы ДО проектирования

**Действия**:
1. Просмотреть находки и требования
2. Выявить неоднозначности (граничные случаи, обработка ошибок, интеграция)
3. Представить ВСЕ вопросы пользователю через AskUserQuestion
4. **Ждать ответов перед Phase 4**
5. Сохранить: `openspec/changes/[feature-name]/phase3-clarifications.md`

### Phase 4: Проектирование архитектуры

**Цель**: Спроектировать архитектуру реализации

**Действия**:
1. Проектировать на основе артефактов phase1-3
2. Для сложных задач — предложить несколько подходов
3. Создать план с атомарными этапами и критериями приемки
4. Сохранить: `openspec/changes/[feature-name]/phase4-architecture.md`

### Phase 5: Ревью плана

**Цель**: Валидировать план ДО реализации

**Действия**:
1. Проверить полноту, корректность, реалистичность плана
2. Если проблемы — обновить plan и повторить
3. Представить план пользователю
4. **Спросить**: "План готов к реализации, можем начинать?"
5. **НЕ ПЕРЕХОДИТЬ К PHASE 6 БЕЗ ОДОБРЕНИЯ!**
6. Сохранить: `openspec/changes/[feature-name]/phase5-plan-review.md`

### Phase 6: Реализация по этапам

**Цель**: Построить доработку атомарными шагами

**НЕ НАЧИНАТЬ БЕЗ ОДОБРЕНИЯ ПОЛЬЗОВАТЕЛЯ!**

Для каждого этапа:
1. Определить тип задачи и подобрать skill:
   - Создание формы → `/form-compile`, `/form-edit`
   - Печатная форма → `/mxl-compile`
   - Настройка прав → `/role-compile`
   - Объект метаданных → `/meta-compile`, `/meta-edit`
   - Обработка/отчёт → `/epf-init`, `/erf-init`
   - Расширение → `/cfe-init`, `/cfe-borrow`
   - Интеграция БСП → `/epf-bsp-init`
   - СКД → `/skd-compile`, `/skd-edit`
   - Загрузка в базу → `/db-load-xml`, `/db-update`
   - Общая задача → писать код вручную
2. Выполнить этап
3. Валидировать результат (соответствующий `/...-validate`)
4. Отметить этап как завершённый в phase4-architecture.md

### Phase 7: Ревью кода

**Цель**: Убедиться в качестве

**Действия**:
1. Проверить код на соответствие плану
2. Проверить качество (стандарты, читаемость, безопасность)
3. Сохранить: `openspec/changes/[feature-name]/phase7-code-review.md`
4. Если найдены проблемы — исправить и повторить

### Phase 8: Итоги

**Действия**:
1. Отметить все задачи завершёнными
2. Создать резюме: `openspec/changes/[feature-name]/phase8-summary.md`
3. Сохранить в RLM (если доступен):
   - `rlm_add_hierarchical_fact` — что построено
   - `rlm_record_causal_decision` — ключевые решения
   - `rlm_sync_state`

## АРТЕФАКТЫ

Все артефакты в `openspec/changes/[feature-name]/`:

```
phase0-complexity.md      # Оценка сложности
phase1-requirements.md    # Требования
phase2-exploration.md     # Исследование кода
phase3-clarifications.md  # Уточнения
phase4-architecture.md    # План (с этапами)
phase5-plan-review.md     # Ревью плана
phase7-code-review.md     # Ревью кода
phase8-summary.md         # Итоги
```

## КРИТИЧЕСКИЕ ПРАВИЛА

1. Phase 0 обязательна — оценка определяет стратегию
2. Phase 3 обязательна — уточнения ДО проектирования
3. Phase 5 обязательна — ревью плана ДО реализации
4. Одобрение пользователя — перед Phase 6
5. Атомарные этапы — каждый с критериями приемки
6. Используй существующие skills — не пиши руками то что автоматизировано
7. Сохранение в RLM — Phase 8 обязательна
